import matplotlib.pyplot as plt
import numpy as np
from Util import common
import os
from scipy.stats.stats import pearsonr
from datetime import datetime


def main():
    #get stock index values
    cfgPath = "../Config/config.cfg"
    common.init(cfgPath)
    
    con = common.getDBConnection()
    cur = con.cursor()
    sql = "select stock_index,date,zscore30,zscore90 from t_daily_stockindex order by date asc"
    cur.execute(sql)
    rows = cur.fetchall()
    stockBasket = {}
    tmpStockBasket = {}
    for row in rows:
        stockIndex = row[0]
        date = row[1]
        zscore30 = row[2]
        zscore90 = row[3]
        if stockIndex not in stockBasket:
            stockBasket[stockIndex] = []
            tmpStockBasket[stockIndex] = {}
        dayValue = {}
        dayValue["date"] = date
        dayValue["zscore30"] = zscore30
        dayValue["zscore90"] = zscore90
        stockBasket[stockIndex].append(dayValue)
        tmpStockBasket[stockIndex][date] = [zscore30,zscore90]
    
    con.close()
    
    stockList = []
    #compute the pearson for each two stock
    for stockIndex in stockBasket:
        stockList.append(stockIndex)
    print stockList  
    
    for i in range(0,9):
        for j in range(i+1,9):
            print stockList[i],stockList[j]
            stock1 = tmpStockBasket[stockList[i]]
            stock2 = tmpStockBasket[stockList[j]]
            compare_stock(stock1,stock2)
                     
    for i in range(0,9):
        for j in range(0,9):
            print stockList[i],stockList[j]
            stock1 = stockBasket[stockList[i]]
            stock2 = stockBasket[stockList[j]]

def compare_stock_shift(stock1,stock2,duration):
    newStock1 = {}
    newStock2 = {}
    for dayValue in stock1:
        newStock1[dayValue["date"]] =  dayValue
    for dayValue in stock2:
        newStock2[dayValue["date"]] =  dayValue
    for date in newStock1:
        if date innewStock2:
            
    
        

def compare_stock(stock1,stock2):
    stock1Z30 = []
    stock1Z90 = []
    stock2Z30 = []
    stock2Z90 = []
    for date in stock1:
        if date in stock2:
            stock1Z30.append(stock1[date][0])
            stock1Z90.append(stock1[date][1])
            stock2Z30.append(stock2[date][0])
            stock2Z90.append(stock2[date][1])
    print len(stock1Z30)
    print pearsonr(stock1Z30,stock2Z30)
    print pearsonr(stock1Z90,stock2Z90)
              
        
if __name__ == "__main__":
    main()            